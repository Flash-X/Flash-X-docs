<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Application’s Use of Orcha &mdash; Flash-X 0.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=7026087e"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Flash-X configuration" href="setup.html" />
    <link rel="prev" title="Milhoja" href="milhoja.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Flash-X
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="disclaimers.html">Current Status and Disclaimers</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch.html">Overview of Flash-X architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="orcha.html">The Performance Portability System</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="orcha_overview.html">Overview of ORCHA</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgkit.html">Code Generation Toolkit</a></li>
<li class="toctree-l2"><a class="reference internal" href="macroprocessor.html">Macroprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="milhoja.html">Milhoja</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Application’s Use of Orcha</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">The Flash-X configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="timeadvance.html">TimeAdvance</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">Physics Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitor.html">Monitor Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_section.html">Developer’s Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Flash-X</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="orcha.html">The Performance Portability System</a></li>
      <li class="breadcrumb-item active">Application’s Use of Orcha</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/application_use.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="application-s-use-of-orcha">
<span id="chp-application-use"></span><h1>Application’s Use of Orcha<a class="headerlink" href="#application-s-use-of-orcha" title="Link to this heading"></a></h1>
<p>In this section we describe the end-to-end pipeline of how an
application can use ORCHA. At first glance it may seem intimidating
because there are several steps involved in the configurations
process, however, the steps are many fewer in terms of what the users
have to do to make use of ORCHA. The onus on the user/domain science
developer are summarized as below.</p>
<ol class="arabic simple">
<li><p>Ensure that all the dependencies are present. These include
Flash-X_recipe_tools, Milhoja_pypkg, and CG-Kit in addition to the
Flash-X distribution which includes setup tool and
macroprocessor. The installation of <a href="#id1"><span class="problematic" id="id2">|</span></a>flashx|_recipe Tools will
resolve all the other dependencies</p></li>
<li><p>Ensure that all data that needs to move to the device either shows
up in the argument list of one of the interfaces, or is moved using
explicit offloading to the device. The data packet generator only
looks at the annotations on the interface file. It assumes that
this is all the data it needs to move to the device. If there is
any additional data that needs to be there at the device, the unit
must include the directives for moving in the code. An example of
the kind of data that users may prefer to move themselves would be
scalars that are common across all blocks and do not change during
the processing of the blocks.</p></li>
<li><p>Add comment blocks into the unit’s interface file. The comment
block starts with !! milhjoa begin, and ends with !! milhoja end.
The first block in the section describes what is common among all
interfaces. For example, blkLimits or the bounds of the block that
is being operated on is common to several interfaces in all
physics. So the extent, the size and the bounds are listed in the
block for describing common properties. Comments above each
interface then describe the size of arguments in that interface,
referring to the common quantities where appropriate. This is
information that is parsed and converted into json files by one of
the code generators in the tool-chain</p></li>
<li><p>Learn to write the recipes in the format that the code generators
can understand. Examples of recipes are provided in the code
segments below.</p></li>
</ol>
<blockquote>
<div><div class="codeseg docutils container">
<p>def load_recipe()
recipe=flashx.TimeStepRecipe()
# assuming [Modulename]_[Routine] format
# JSON files will be populated by reading</p>
<blockquote>
<div><p>[Modulename]_interface.F90</p>
</div></blockquote>
<p>hydro_begin = recipe.begin_orchestration(after=recipe.root)
hydro_prepblock=recipe.add.work(“Hydro_prepBlock”,
after=hydro_begin, map_to=gpu)
hydro_advance = recipe.add.work(“Hydro_advance”,
after=hydro_prepblock, map_to=gpu)
hydro_end = recipe.end_orchestration(hydro_begin,
after=hydro_advance)
return recipe</p>
</div>
</div></blockquote>
<p>The recipe described above is the simplest time-stepper for the Hydro
unit when no other physics in called by the time-stepper. Here the
first action is to start the recipe, the interface <em>Hydro_prepBlock”
allocates all the scratch space needed for computing one block, and it
also queries the *Grid</em> unit for all the quantities such as physical
coordinates, or cell areas etc that it might need. The interface
<em>Hydro_advance</em> computes the fluxes and advances the result in
time. In this instance, because both the tasks are mapped to the GPU,
the task function generated simply invokes these interfaces one after
the other, and the data packet is generated for the union of data used
by the two interfaces. Note that the code will work perfectly fine
without doing any of the steps described above, however, the
performance advantages from latency hiding for data movement will not
be possible.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="milhoja.html" class="btn btn-neutral float-left" title="Milhoja" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="setup.html" class="btn btn-neutral float-right" title="The Flash-X configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Flash-X Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>