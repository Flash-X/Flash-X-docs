

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Converting from FLASH to Flash-X &mdash; Flash-X 0.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=7026087e"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Flash-X
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="disclaimers.html">Current Status and Disclaimers</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch.html">Overview of Flash-X architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="orcha.html">The Performance Portability System</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">The Flash-X configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="timeadvance.html">TimeAdvance</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">Physics Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitor.html">Monitor Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_section.html">Developer’s Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Flash-X</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Converting from FLASH to Flash-X</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/FLASH-to-Flash-x.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="converting-from-flash-to-flash-x">
<span id="sec-converting"></span><h1>Converting from FLASH to Flash-X<a class="headerlink" href="#converting-from-flash-to-flash-x" title="Link to this heading"></a></h1>
<p>Converting FLASH source to Flash-X source so that it can build with
basic functionality is relatively straightforward if advanced features
of the software system are not to be used. Many low level routines
will compile without any modifications. However, several commonly used
interfaces have changed, and some units have been reorganized. The
<em>Driver</em> unit no longer implements time integration, there is a new
unit <em>TimeAdvance</em> where the integrators reside. In addition to the
Strang-split integrator inherited from FLASH there is a new
implementation of this new unit that uses the  method of lines
<em>Mol</em>. With full integration of CG-Kit into the code this unit is
likely to be converted into a collection of recipes. The <em>Driver</em> unit
only handles the book keeping such as checking for and doing
refinement, checkpointing and other I/O related actions.</p>
<p>The <em>Grid</em> unit has had fairly extensive changes to its API. The
biggest change from the perspective of physics units is that  bounds
(typically stored in blkLimits and blkLimitsGC)
for a block are based on global view instead of local view that
FLASH used.   Therefore, even with fixed block sizes, the values of
in the above two arrays are not identical for all blocks. The second
major change is in looping over blocks. Instead of obtaining a list of
blocks from the grid unit and looping over them through <em>block_id</em> we
now have iterators for looping over blocks. Several quantities that
could only be obtained through explicit interfaces such as
<em>Grid_getBlkPtr</em> are now accessible through the functions provided by
the iterators.</p>
<p>For example, in FLASH, following code lines appear in a file that has looping over blocks:</p>
<div class="codeseg docutils container">
<p>use Grid_interface, ONLY: Grid_getListofBlocks, Grid_getBlkLimits
!! some more use statements</p>
<p>integer :: blockCount, blockList(MAXBLOCKS)
integer, dimension(LOW:HIGH,MDIM) :: blkLimits, blkLimitsGC
real, dimension(MDIM):: deltas
real, dimension(:,:,:,:), pointer || Uin</p>
<p>call Grid_getListofBlocks(blockCount,blockList,LEAF)
do i = 1,blockcount</p>
<blockquote>
<div><p>blockid=blockList(i)
call Grid_getBlkLimits(blockid,blkLimits,blkLimitsGC)
call Grid_getDeltas(blockid,deltas)
call Grid_getBlkPtr(blockid,Uin,CENTER)</p>
<p>!! some code for operating on the block</p>
</div></blockquote>
<p>end do</p>
</div>
<p>In Flash-X Grid_getListofBlocks is deprecated, and does not work with
AMReX. The code lines that provide the same functionality are</p>
<div class="codeseg docutils container">
<p>use Grid_interface, ONLY : Grid_getTileIterator, Grid_releaseTileIterator
use Grid_tile,         ONLY : Grid_tile_t
use Grid_iterator,     ONLY : Grid_iterator_t</p>
<p>type(Grid_iterator_t) :: itor
type(Grid_tile_t) :: tileDesc
integer, dimension(LOW:HIGH,MDIM) :: blkLimits, blkLimitsGC,grownLimits
real, dimension(MDIM):: deltas
real, dimension(:,:,:,:), pointer || Uin</p>
<p>call Grid_getTileIterator(itor,LEAF,level)
do while(itor%%isValid())</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>call itor%%currentTile(tileDesc)
blkLimits(:,:)=tileDesc%%limits
blkLimitsGC=tileDesc%%blkLimitsGC
call tileDesc%getDataPtr(Uin, CENTER)
call tileDesc%deltas(del)</p>
<p>!! some code for operating on the block</p>
</div></blockquote>
<p>call tileDesc%releaseDataPtr(Uin,CENTER)
call itor%next()</p>
</div></blockquote>
<p>end do !!block loop
call Grid_releaseTileIterator(itor)</p>
</div></blockquote>
</div>
<p>Using general purpose macros provided with the code the same code can
be reduced to</p>
<div class="codeseg docutils container">
<p>&#64;M iter_use
&#64;M iter_declare(blkLimits,blkLimitsGC, grownLimits)
&#64;M iter_all_begin(LEAF,.false., blkLimits,blkLimitsGC, grownLimits)</p>
<blockquote>
<div><p>!! some code for operating on the block</p>
</div></blockquote>
<p>&#64;M iter_end</p>
</div>
<p>Note that &#64;M iter_declare would expand to</p>
<div class="codeseg docutils container">
<p>type(Grid_iterator_t) :: itor
real,   pointer    :: Uin(:,:,:,:)
type(Grid_tile_t)     :: tileDesc
integer :: level
integer, dimension(LOW:HIGH,MDIM) :: blkLimits,blkLimitsGC, grownLimits
real,dimension(MDIM) :: deltas</p>
</div>
<p>In this macro, the declarations of arrays containing bounds can be
changed by changing the argument list, for example instead of
blkLimits,blkLimitsGC, grownLimits as arguments one could use
limit1, limit2, limit3 as the argument list and the corresponding
expansion would change to</p>
<div class="codeseg docutils container">
<p>type(Grid_iterator_t) :: itor
real,   pointer    :: Uin(:,:,:,:)
type(Grid_tile_t)     :: tileDesc
integer :: level
integer, dimension(LOW:HIGH,MDIM) :: limit1, limit2, limit3
real,dimension(MDIM) :: deltas</p>
</div>
<p>However, the declarations of itor, Uin, deltas, level and tileDesc are
unchangeable. Users wishing to use different variable names for these
quantities can define their own macros either with a larger argument
list or different explicit variable names. It would be best to keep
the newly defined macros local to the user’s own code component and
give it a different name to avoid causing any ambiguity in expansion.
The final version of Flash-X is envisioned to
have iteration over block occur only at the level of the <em>TimeAdvance</em>
unit.</p>
<p>Several new interfaces in the <em>Grid</em> API are introduced for greater
flexibility in handling fluxes and their reconciliation at fine-coarse
boundaries. These are needed for new time integrater, whether Mol or
higher order methods. Currently many interfaces do not have any real
implentations included. They may be eliminated or implemented in
future. The commonly used interfaces that have changed from FLASH to
<a href="#id1"><span class="problematic" id="id2">|flash-x|</span></a> are listed below.</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Flash-X Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>